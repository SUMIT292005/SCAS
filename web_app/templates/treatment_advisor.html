{% extends "base.html" %}

{% block title %}üåø Treatment Advisor{% endblock %}

{% block head %}
<script>
// Disease options data
const diseaseOptions = {
    "Cotton": [
        "Bacterial Blight",
        "Target Spot/Alternaria", 
        "Powdery Mildew",
        "Curl Virus",
        "Healthy"
    ],
    "Tomato": [
        "Early Blight",
        "Late Blight",
        "Leaf Curl Virus",
        "Mosaic Virus",
        "Septoria",
        "Healthy"
    ],
    "Maize": [
        "Northern Leaf Blight",
        "Common Rust",
        "Gray Leaf Spot",
        "Healthy"
    ]
};

document.addEventListener("DOMContentLoaded", function() {
    // Set up crop change listener
    document.getElementById("crop").addEventListener("change", handleCropChange);
    
    // Set up form submit handler
    document.querySelector('form').addEventListener("submit", handleFormSubmit);
    
    // Add entrance animations
    document.querySelector('.page-header').classList.add('slide-in-left');
    document.querySelector('.advisor-form').classList.add('slide-in-up');
    
    // Add animations to results if they exist
    const resultsSection = document.querySelector('.results-section');
    if (resultsSection) {
        resultsSection.classList.add('fade-in');
    }
});

function handleCropChange() {
    const crop = document.getElementById("crop").value;
    const diseaseSelect = document.getElementById("disease");
    const submitBtn = document.querySelector('.submit-btn');
    
    // Add loading animation to disease dropdown
    diseaseSelect.innerHTML = '<option value="">üîÑ Loading diseases...</option>';
    diseaseSelect.disabled = true;
    diseaseSelect.classList.add('loading');
    
    // Simulate loading delay for better UX
    setTimeout(() => {
        diseaseSelect.innerHTML = '<option value="">-- Select Disease --</option>';
        diseaseSelect.classList.remove('loading');
        
        if (diseaseOptions[crop]) {
            diseaseOptions[crop].forEach(disease => {
                const opt = document.createElement("option");
                opt.value = disease;
                opt.textContent = getDiseaseName(disease);
                diseaseSelect.appendChild(opt);
            });
            diseaseSelect.disabled = false;
            diseaseSelect.classList.add('data-loaded');
            setTimeout(() => diseaseSelect.classList.remove('data-loaded'), 1000);
            
            showNotification(`Loaded ${diseaseOptions[crop].length} diseases for ${crop}`, "success");
        }
        
        // Update submit button state
        updateSubmitButton();
    }, 500);
}

function getDiseaseName(disease) {
    const diseaseEmojis = {
        "Bacterial Blight": "ü¶† Bacterial Blight",
        "Target Spot/Alternaria": "üéØ Target Spot/Alternaria",
        "Powdery Mildew": "‚òÅÔ∏è Powdery Mildew", 
        "Curl Virus": "üåÄ Curl Virus",
        "Early Blight": "üçÇ Early Blight",
        "Late Blight": "üå´Ô∏è Late Blight",
        "Leaf Curl Virus": "üåÄ Leaf Curl Virus",
        "Mosaic Virus": "üî≥ Mosaic Virus",
        "Septoria": "üî¨ Septoria",
        "Northern Leaf Blight": "üçÉ Northern Leaf Blight",
        "Common Rust": "ü¶† Common Rust",
        "Gray Leaf Spot": "‚ö´ Gray Leaf Spot",
        "Healthy": "‚úÖ Healthy"
    };
    return diseaseEmojis[disease] || disease;
}

function updateSubmitButton() {
    const cropValue = document.getElementById("crop").value;
    const diseaseValue = document.getElementById("disease").value;
    const submitBtn = document.querySelector('.submit-btn');
    
    if (cropValue && diseaseValue) {
        submitBtn.disabled = false;
        submitBtn.classList.add('ready');
        submitBtn.innerHTML = '<i class="fas fa-stethoscope"></i> Get Treatment Recommendation';
    } else {
        submitBtn.disabled = true;
        submitBtn.classList.remove('ready');
        submitBtn.innerHTML = '<i class="fas fa-seedling"></i> Select Crop & Disease';
    }
}

function handleFormSubmit(e) {
    const submitBtn = e.target.querySelector('.submit-btn');
    const originalText = submitBtn.innerHTML;
    
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-brain fa-spin"></i> Analyzing treatment options...';
    
    // Form will submit normally, this is just for visual feedback
    setTimeout(() => {
        // In case form doesn't redirect, restore button
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
    }, 5000);
}

function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.innerHTML = `
        <i class="fas fa-${type === 'error' ? 'exclamation-triangle' : type === 'success' ? 'check-circle' : 'info-circle'}"></i>
        <span>${message}</span>
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.classList.add('show');
    }, 100);
    
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
            if (document.body.contains(notification)) {
                document.body.removeChild(notification);
            }
        }, 300);
    }, 3000);
}

// Add disease dropdown change listener to update submit button
document.addEventListener("DOMContentLoaded", function() {
    document.getElementById("disease").addEventListener("change", updateSubmitButton);
});
</script>

<style>
  .page-header {
    background: linear-gradient(135deg, var(--accent-green), var(--accent-blue));
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 0 0 30px rgba(0, 255, 127, 0.5);
    font-size: 2.5rem;
    font-weight: bold;
    margin-bottom: 40px;
    text-align: center;
    animation: titleGlow 2s ease-in-out infinite alternate;
  }
  
  @keyframes titleGlow {
    0% { filter: drop-shadow(0 0 10px rgba(0, 255, 127, 0.5)); }
    100% { filter: drop-shadow(0 0 20px rgba(0, 255, 127, 0.8)); }
  }
  
  .advisor-form {
    background: rgba(26, 31, 53, 0.8);
    backdrop-filter: blur(15px);
    border: 1px solid rgba(0, 255, 127, 0.3);
    border-radius: 20px;
    padding: 40px;
    position: relative;
    overflow: hidden;
    margin-bottom: 40px;
  }
  
  .advisor-form::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: 
      radial-gradient(circle at 10% 20%, rgba(0, 255, 127, 0.1) 0%, transparent 50%),
      radial-gradient(circle at 90% 80%, rgba(0, 212, 255, 0.1) 0%, transparent 50%);
    z-index: -1;
  }
  
  .form-section {
    display: grid;
    gap: 30px;
    max-width: 600px;
    margin: 0 auto;
  }
  
  .form-group {
    position: relative;
  }
  
  .form-label {
    color: var(--text-light);
    font-weight: 600;
    margin-bottom: 12px;
    display: block;
    font-size: 1.1rem;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .enhanced-select {
    background: rgba(10, 15, 28, 0.8);
    border: 2px solid rgba(0, 255, 127, 0.3);
    color: var(--text-light);
    border-radius: 12px;
    padding: 15px 20px;
    font-size: 1.1rem;
    width: 100%;
    transition: all 0.3s ease;
    cursor: pointer;
    appearance: none;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%2300ff7f' viewBox='0 0 16 16'%3e%3cpath d='M8 10.5L3.5 6H12.5L8 10.5z'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 15px center;
    background-size: 12px;
  }
  
  .enhanced-select:focus {
    background-color: rgba(10, 15, 28, 0.9);
    border-color: var(--accent-green);
    box-shadow: 0 0 20px rgba(0, 255, 127, 0.3);
    outline: none;
    transform: translateY(-2px);
  }
  
  .enhanced-select:disabled {
    background-color: rgba(10, 15, 28, 0.5);
    border-color: rgba(0, 255, 127, 0.2);
    cursor: not-allowed;
    opacity: 0.7;
  }
  
  .enhanced-select option {
    background: var(--secondary-dark);
    color: var(--text-light);
    padding: 12px;
  }
  
  .enhanced-select.loading {
    border-color: #ffa500;
    animation: pulse 1.5s ease-in-out infinite;
  }
  
  @keyframes pulse {
    0%, 100% { border-color: #ffa500; }
    50% { border-color: rgba(255, 165, 0, 0.5); }
  }
  
  .enhanced-select.data-loaded {
    border-color: var(--accent-green);
    box-shadow: 0 0 15px rgba(0, 255, 127, 0.4);
  }
  
  .submit-btn {
    background: linear-gradient(45deg, #666, #999);
    border: none;
    color: var(--text-light);
    font-weight: bold;
    font-size: 1.2rem;
    padding: 18px 40px;
    border-radius: 25px;
    width: 100%;
    transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    cursor: not-allowed;
    position: relative;
    overflow: hidden;
    margin-top: 20px;
  }
  
  .submit-btn.ready {
    background: linear-gradient(45deg, var(--accent-green), var(--accent-blue));
    color: var(--primary-dark);
    cursor: pointer;
  }
  
  .submit-btn.ready::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    transition: all 0.5s ease;
  }
  
  .submit-btn.ready:hover::before {
    left: 100%;
  }
  
  .submit-btn.ready:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 35px rgba(0, 255, 127, 0.4);
  }
  
  .submit-btn:disabled {
    opacity: 0.7;
    transform: none;
  }
  
  .results-section {
    background: rgba(26, 31, 53, 0.9);
    backdrop-filter: blur(15px);
    border: 1px solid rgba(0, 255, 127, 0.4);
    border-radius: 20px;
    padding: 30px;
    position: relative;
    overflow: hidden;
  }
  
  .results-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 2px;
    background: linear-gradient(90deg, var(--accent-green), var(--accent-blue), var(--accent-green));
    animation: borderGlow 2s ease-in-out infinite;
  }
  
  @keyframes borderGlow {
    0%, 100% { opacity: 0.5; }
    50% { opacity: 1; }
  }
  
  .results-header {
    color: var(--accent-green);
    font-size: 1.5rem;
    font-weight: bold;
    margin-bottom: 25px;
    display: flex;
    align-items: center;
    gap: 10px;
    text-shadow: 0 0 10px rgba(0, 255, 127, 0.5);
  }
  
  .treatment-message {
    background: rgba(0, 212, 255, 0.1);
    border: 1px solid rgba(0, 212, 255, 0.3);
    border-radius: 12px;
    padding: 20px;
    color: var(--text-light);
    font-size: 1.1rem;
    display: flex;
    align-items: center;
    gap: 12px;
  }
  
  .treatment-categories {
    display: grid;
    gap: 25px;
    margin-top: 20px;
  }
  
  .treatment-category {
    background: rgba(10, 15, 28, 0.6);
    border-radius: 15px;
    padding: 25px;
    border-left: 5px solid var(--accent-green);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }
  
  .treatment-category:hover {
    background: rgba(10, 15, 28, 0.8);
    transform: translateX(5px);
    box-shadow: 0 10px 30px rgba(0, 255, 127, 0.2);
  }
  
  .treatment-category.chemical {
    border-left-color: #ff6b6b;
  }
  
  .treatment-category.organic {
    border-left-color: #4ecdc4;
  }
  
  .treatment-category.cultural {
    border-left-color: #45b7d1;
  }
  
  .category-header {
    color: var(--accent-green);
    font-size: 1.3rem;
    font-weight: bold;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .category-header.chemical {
    color: #ff6b6b;
  }
  
  .category-header.organic {
    color: #4ecdc4;
  }
  
  .category-header.cultural {
    color: #45b7d1;
  }
  
  .treatment-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  
  .treatment-item {
    background: rgba(0, 0, 0, 0.3);
    padding: 12px 15px;
    margin-bottom: 8px;
    border-radius: 8px;
    color: var(--text-light);
    transition: all 0.3s ease;
    position: relative;
    padding-left: 35px;
  }
  
  .treatment-item::before {
    content: '‚úì';
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--accent-green);
    font-weight: bold;
    font-size: 1rem;
  }
  
  .treatment-item:hover {
    background: rgba(0, 0, 0, 0.5);
    transform: translateX(10px);
  }
  
  .notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(26, 31, 53, 0.95);
    backdrop-filter: blur(15px);
    border: 1px solid rgba(0, 255, 127, 0.3);
    border-radius: 12px;
    padding: 15px 20px;
    color: var(--text-light);
    z-index: 10000;
    transform: translateX(100%);
    transition: transform 0.3s ease;
    display: flex;
    align-items: center;
    gap: 10px;
    max-width: 350px;
  }
  
  .notification.success {
    border-color: rgba(0, 255, 127, 0.5);
  }
  
  .notification.error {
    border-color: rgba(220, 53, 69, 0.5);
  }
  
  .notification.show {
    transform: translateX(0);
  }
  
  .notification i {
    color: var(--accent-green);
  }
  
  .notification.success i {
    color: var(--accent-green);
  }
  
  .notification.error i {
    color: #ff6b6b;
  }
  
  /* Animation Classes */
  .fade-in {
    animation: fadeIn 0.8s ease-in;
  }
  
  .slide-in-up {
    animation: slideInUp 0.6s ease-out;
  }
  
  .slide-in-left {
    animation: slideInLeft 0.6s ease-out;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  @keyframes slideInUp {
    from { opacity: 0; transform: translateY(30px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  @keyframes slideInLeft {
    from { opacity: 0; transform: translateX(-50px); }
    to { opacity: 1; transform: translateX(0); }
  }
  
  /* Enhanced Crop Icons */
  .crop-icon {
    display: inline-block;
    margin-right: 8px;
    font-size: 1.2rem;
  }
  
  /* Responsive Design */
  @media (max-width: 768px) {
    .advisor-form {
      padding: 20px;
    }
    
    .page-header {
      font-size: 2rem;
    }
    
    .form-section {
      max-width: 100%;
    }
    
    .enhanced-select {
      padding: 12px 15px;
      font-size: 1rem;
    }
    
    .treatment-categories {
      gap: 20px;
    }
    
    .treatment-category {
      padding: 20px;
    }
    
    .notification {
      right: 10px;
      left: 10px;
      max-width: none;
      transform: translateY(-100%);
    }
    
    .notification.show {
      transform: translateY(0);
    }
  }
  
  @media (max-width: 480px) {
    .page-header {
      font-size: 1.8rem;
    }
    
    .results-header {
      font-size: 1.3rem;
    }
    
    .category-header {
      font-size: 1.2rem;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2 class="page-header">üåø Crop Treatment Advisor</h2>

  <!-- Form Section -->
  <form action="{{ url_for('treatment_routes.recommend_treatment_route') }}" method="POST" class="advisor-form">
    <div class="form-section">
      <div class="form-group">
        <label for="crop" class="form-label">
          <i class="fas fa-seedling"></i> Select Crop
        </label>
        <select id="crop" name="crop" class="enhanced-select" required>
          <option value="">-- Select Crop --</option>
          <option value="Cotton">üåæ Cotton</option>
          <option value="Tomato">üçÖ Tomato</option>
          <option value="Maize">üåΩ Maize</option>
        </select>
      </div>

      <div class="form-group">
        <label for="disease" class="form-label">
          <i class="fas fa-virus"></i> Select Disease
        </label>
        <select id="disease" name="disease" class="enhanced-select" required disabled>
          <option value="">-- Select Disease --</option>
        </select>
      </div>

      <button type="submit" class="submit-btn" disabled>
        <i class="fas fa-seedling"></i> Select Crop & Disease
      </button>
    </div>
  </form>

  <!-- Results Section -->
  {% if recommendation %}
  <div class="results-section">
    <h4 class="results-header">
      <i class="fas fa-prescription-bottle-alt"></i> Recommended Treatment Plan
    </h4>

    {% if recommendation.Message %}
      <div class="treatment-message">
        <i class="fas fa-info-circle"></i>
        <span>{{ recommendation.Message }}</span>
      </div>
    {% else %}
      <div class="treatment-categories">
        <div class="treatment-category chemical">
          <div class="category-header chemical">
            <i class="fas fa-flask"></i> Chemical Treatment
          </div>
          <ul class="treatment-list">
            {% for chem in recommendation.Chemical %}
              <li class="treatment-item">{{ chem }}</li>
            {% endfor %}
          </ul>
        </div>

        <div class="treatment-category organic">
          <div class="category-header organic">
            <i class="fas fa-leaf"></i> Organic Treatment
          </div>
          <ul class="treatment-list">
            {% for org in recommendation.Organic %}
              <li class="treatment-item">{{ org }}</li>
            {% endfor %}
          </ul>
        </div>

        <div class="treatment-category cultural">
          <div class="category-header cultural">
            <i class="fas fa-users"></i> Cultural Practices
          </div>
          <ul class="treatment-list">
            {% for cult in recommendation.Cultural %}
              <li class="treatment-item">{{ cult }}</li>
            {% endfor %}
          </ul>
        </div>
      </div>

      <div style="margin-top: 30px; padding: 20px; background: rgba(0, 255, 127, 0.1); border-radius: 12px; border: 1px solid rgba(0, 255, 127, 0.3);">
        <h6 style="color: var(--accent-green); margin-bottom: 15px; font-weight: bold; display: flex; align-items: center; gap: 8px;">
          <i class="fas fa-lightbulb"></i> Expert Tips
        </h6>
        <ul style="margin: 0; padding-left: 20px; color: var(--text-light);">
          <li style="margin-bottom: 8px;">Always read and follow label instructions when using chemical treatments</li>
          <li style="margin-bottom: 8px;">Combine multiple treatment approaches for best results</li>
          <li style="margin-bottom: 8px;">Monitor crop response and adjust treatment as needed</li>
          <li>Consult with local agricultural experts for region-specific advice</li>
        </ul>
      </div>
    {% endif %}
  </div>
  {% endif %}
</div>
{% endblock %}